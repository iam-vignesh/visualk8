<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Kubernetes Resource Visualizer</title>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
        <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
        <link rel="icon" type="image/x-icon" href="./assets/favicon-32x32.png">
        <style>
            :root {
                --primary-color: #125198;
                --secondary-color: #f5f7fa;
                --text-color: #212121;
                --border-color: #e0e0e0;
                --success-color: #28a745;
                --error-color: #dc3545;
            }
    
            body {
                font-family: 'Inter', sans-serif;
                background-color: var(--secondary-color);
                color: var(--text-color);
                line-height: 1.6;
                margin: 0;
                padding: 0;
            }
    
            .container {
                max-width: 1200px;
                margin: 0 auto;
                /* padding: 40px 20px; */
                padding-top: 40px !important;
            }
    
            header {
                background-color: rgb(210, 228, 247);
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                padding: 20px 0;
            }
/*     
             h1 {
                color: var(--primary-color);
                text-align: center;
                margin-bottom: 10px;
                font-weight: 700;
                padding: 40px 20px;
                
            } */
    
            /* .subtitle {
                text-align: center;
                margin-bottom: 30px;
                color: #666;
            } */

                
            h1 {
                color: var(--primary-color);
                font-weight: 700;
                padding-top: 20px !important;
                padding-left: 10px !important;
                padding-bottom: 5px !important;
                
            }

            .subtitle {
                max-width: 1200px;
                margin: 0 auto;
                padding-left: 10px;
            }
    
            .card {
                background-color: white;
                border-radius: 8px;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                padding: 20px;
                margin-bottom: 30px;
            }
    
            textarea, .error-console, .visualization, .yaml-display {
                width: 100%;
                padding: 15px;
                margin-bottom: 20px;
                border: 1px solid var(--border-color);
                border-radius: 4px;
                box-sizing: border-box;
                font-size: 14px;
            }
    
            textarea {
                height: 200px;
                resize: vertical;
            }
    
            .error-console {
                background-color: var(--secondary-color);
                color: var(--text-color);
                min-height: 40px;
            }
    
            .visualization {
                height: 500px;
                background-color: white;
            }
    
            #yamlContainer {
                margin-top: 30px;
            }
    
            #yamlObjectName {
                margin-bottom: 10px;
                font-weight: 600;
            }
    
            .yaml-display {
                height: 300px;
                background-color: #f8f9fa;
                overflow-y: auto;
                font-family: monospace;
                white-space: pre-wrap;
            }
    
            .btn {
                display: inline-block;
                padding: 12px 24px;
                background-color: var(--primary-color);
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 16px;
                font-weight: 600;
                transition: background-color 0.3s ease;
            }
    
            .btn:hover {
                background-color: #3a7bc8;
            }
    
            select {
                width: 100%;
                padding: 12px;
                margin-bottom: 20px;
                border: 1px solid var(--border-color);
                border-radius: 4px;
                background-color: white;
                font-size: 16px;
                appearance: none;
                background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23333' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
                background-repeat: no-repeat;
                background-position: right 12px center;
            }
    
            footer {
                text-align: center;
                padding: 20px 0;
                font-size: 0.9em;
                color: #666;
                background-color: white;
                border-top: 1px solid var(--border-color);
                
            }
    
            .footer-link {
                color: var(--primary-color);
                text-decoration: none;
            }
    
            .footer-link:hover {
                text-decoration: underline;
            }

            .kubernetesdocs{
                align-items: center;
            }

            .dropdown {
            position: relative;
            display: inline-block;
            }

            .dropdown-content {
                display: none;
                position: absolute;
                background-color: #f9f9f9;
                min-width: 160px;
                box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
                z-index: 1;
            }

            .dropdown-content a {
                color: black;
                padding: 12px 16px;
                text-decoration: none;
                display: block;
            }

            .dropdown-content a:hover {background-color: #f1f1f1}

            .dropdown:hover .dropdown-content {
                display: block;
            }


        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 600px;
        border-radius: 8px;
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }

    .close:hover,
    .close:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
    }
    
            @media (max-width: 768px) {
                .container {
                    padding: 20px 10px;
                }
            }
        </style>
    </head>
    <body>
        <header>
            <h1 class="container">Kubernetes Cluster Visualizer</h1>
            <p class="subtitle"><strong>Visualize your Kubernetes Cluster for freeüöÄ<br>No signup required!üî•</strong></p>
        </header>

        <div class="container">
            <!-- New button group -->
            <div class="btn-group">
                <button class="btn" onclick="openTutorial()">How to Use</button>
                <div class="dropdown">
                    <button class="btn btn-secondary" onclick="exportVisualization()">Export Visual</button>
                </div>
            </div>

            <div id="tutorialModal" class="modal">
                <div class="modal-content">
                    <span class="close" onclick="closeTutorial()">&times;</span>
                    <h2>How to Use the Kubernetes Resource Visualizer</h2>
                    <ol>
                        <li>Paste your Kubernetes YAML configurations into the YAML Editor textarea.</li>
                        <li>In case of multiple YAML configurations, paste one followed by the delimiter "---" in new line.</li>
                        <li>Click the "Visualize" button to generate a visual representation of your resources.</li>
                        <li>Use the dropdown to filter resources by type.</li>
                        <li>Click on nodes in the visualization to view their respective YAML configuration.</li>
                        <li>Use the "Export Visual" buttons to download your visualization.</li>
                    </ol>
                </div>
            </div>
    
        <div class="container">
            <div class="card">
                <h3>YAML Editor</h3>
                <textarea id="yamlInput" placeholder="Paste your Kubernetes YAML configs here. Separate multiple configs using '---' in new line."></textarea>
                
                <div class="error-console" id="errorConsole">Error Console</div>
    
                <button class="btn" onclick="visualizeResources()">Visualize</button>
            </div>
            
            <div class="card">
                <h3>Your Cluster Map</h3>
    
                <select id="filterKind" onchange="applyFilter()">
                    <option value="All">All Resources</option>
                    <option value="Deployment">Deployment</option>
                    <option value="Service">Service</option>
                    <option value="Pod">Pod</option>
                    <option value="Ingress">Ingress</option>
                    <option value="ConfigMap">ConfigMap</option>
                    <option value="Secret">Secret</option>
                    <option value="PersistentVolumeClaim">PersistentVolumeClaim</option>
                </select>
                
                <div id="visualization" class="visualization"></div>
            </div>
    
            <div id="yamlContainer" class="card" style="display: none;">
                <h3 id="yamlObjectName">Select an object to display their YAML config</h3>
                <div id="yamlDisplay" class="yaml-display"></div>
            </div>

            <div id="kubernetesdocs" class="card">
                <h3>Useful Links</h3>
                <a href="https://kubernetes.io/docs/home/" target="_blank" class="footer-link">Kubernetes Docs</a>
                <br>
                <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/" target="_blank" class="footer-link">Understanding Kubernetes Objects</a>
                <br>
                <a href="https://kubernetes.io/docs/concepts/configuration/overview/" target="_blank" class="footer-link">Kubernetes Configuration Best Practices</a>
            </div>

        </div>


    <script>
        let network;
        let allNodes;
        let allEdges;
        let resourceMap = new Map();

        function visualizeResources() {
            const yamlInput = document.getElementById('yamlInput');
            const resources = yamlInput.value.split('---').map(doc => doc.trim()).filter(doc => doc);
            const errorConsole = document.getElementById('errorConsole');
            const yamlContainer = document.getElementById('yamlContainer');

            try {
                const nodes = [];
                const edges = [];
                resourceMap.clear();

                resources.forEach((resource, index) => {
                    const obj = jsyaml.load(resource);
                    if (!obj || !obj.kind || !obj.metadata || !obj.metadata.name) {
                        throw new Error(`Invalid YAML in resource ${index + 1}`);
                    }

                    const id = `${obj.kind}-${obj.metadata.name}`;
                    resourceMap.set(id, { yaml: resource, obj: obj });

                    nodes.push({
                        id: id,
                        label: `${obj.kind}\n${obj.metadata.name}`,
                        shape: 'box',
                        color: getColorForKind(obj.kind)
                    });
                });

                resourceMap.forEach((resource, id) => {
                    const obj = resource.obj;
                    if (obj.kind === 'Service' && obj.spec && obj.spec.selector) {
                        resourceMap.forEach((target, targetId) => {
                            const targetObj = target.obj;
                            if (targetObj.kind === 'Deployment' && targetObj.spec && targetObj.spec.template && targetObj.spec.template.metadata && targetObj.spec.template.metadata.labels) {
                                if (matchLabels(obj.spec.selector, targetObj.spec.template.metadata.labels)) {
                                    edges.push({ from: id, to: targetId, arrows: 'to' });
                                }
                            }
                        });
                    }
                });

                allNodes = new vis.DataSet(nodes);
                allEdges = new vis.DataSet(edges);
                const data = { nodes: allNodes, edges: allEdges };
                const options = {
                    layout: { hierarchical: { enabled: true, direction: 'UD', sortMethod: 'directed' } },
                    physics: { enabled: false }
                };

                const container = document.getElementById('visualization');

                network = new vis.Network(container, data, options);
                network.on("click", function (params) {
            if (params.nodes.length > 0) {
                const nodeId = params.nodes[0];
                displayYAML(nodeId);
                }
                });

                network.on("click", function (params) {
                    if (params.nodes.length > 0) {
                        const nodeId = params.nodes[0];
                        displayYAML(nodeId);
                    }
                });

                errorConsole.textContent = 'No YAML error detected.';
                errorConsole.style.backgroundColor = '#d4edda';
                errorConsole.style.color = '#155724';
                yamlContainer.style.display = 'block';

            if (nodes.length > 0) {
                    yamlContainer.style.display = 'block';
            } else {
                    yamlContainer.style.display = 'none';
                }

            } catch (error) {
                console.error('Error parsing YAML:', error);
                errorConsole.textContent = `Error: ${error.message}`;
                errorConsole.style.backgroundColor = '#f8d7da';
                errorConsole.style.color = '#721c24';
                yamlContainer.style.display = 'none';
            }
        }

        function matchLabels(selector, labels) {
            return Object.entries(selector).every(([key, value]) => labels[key] === value);
        }

        function getColorForKind(kind) {
            const colors = {
                'Deployment': '#3498db',
                'Service': '#2ecc71',
                'Pod': '#e74c3c',
                'Ingress': '#f39c12',
                'ConfigMap': '#9b59b6',
                'Secret': '#34495e',
                'PersistentVolumeClaim': '#1abc9c'
            };
            return colors[kind] || '#bdc3c7';
        }

        function applyFilter() {
            const filterKind = document.getElementById('filterKind').value;
            const filteredNodes = allNodes.get({
                filter: function (node) {
                    return filterKind === 'All' || node.id.startsWith(filterKind);
                }
            });
            network.setData({ nodes: filteredNodes, edges: allEdges });
        }

        function displayYAML(nodeId) {
            const yamlDisplay = document.getElementById('yamlDisplay');
            const yamlObjectName = document.getElementById('yamlObjectName');
            if (resourceMap.has(nodeId)) {
                const resource = resourceMap.get(nodeId);
                const obj = resource.obj;
                yamlDisplay.textContent = resource.yaml;
                yamlObjectName.textContent = `${obj.kind}: ${obj.metadata.name}`;
                yamlDisplay.textContent = resource.yaml;
            } else {
                yamlDisplay.textContent = 'No YAML configuration found for this node.';
                yamlDisplay.textContent = 'Click on a node in the visualization to see its YAML configuration.';
            }
        }

        function openTutorial() {
        document.getElementById('tutorialModal').style.display = 'block';
    }

        function closeTutorial() {
        document.getElementById('tutorialModal').style.display = 'none';
    }


        function exportYAML() {
            const yamlInput = document.getElementById('yamlInput').value;
            const blob = new Blob([yamlInput], {type: 'text/yaml'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'kubernetes_config.yaml';
            a.click();
        }

        function exportVisualization() {
            // Get the visualization div
            const visualizationDiv = document.getElementById('visualization');

            // Use html2canvas to capture the visualization as an image
            html2canvas(visualizationDiv).then(canvas => {
                // Convert the canvas to a data URL
                const imageDataURL = canvas.toDataURL('image/png');
                
                // Create a link element and trigger the download
                const a = document.createElement('a');
                a.href = imageDataURL;
                a.download = 'kubernetes_visualization.png';
                a.click();
            });
        }

        window.onclick = function(event) {
        if (event.target == document.getElementById('tutorialModal')) {
            closeTutorial();
        }
    }

        // Initialize with empty visualization
        visualizeResources();
    </script>

    <footer>
        Made with ‚ù§Ô∏è by <a href="https://www.linkedin.com/in/vigneshravipublic/" target="_blank" class="footer-link">Vignesh Ravi</a>
    </footer>
</body>
</html>